<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestión de Consumo Eléctrico</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        body {
            margin: 0;
            background: linear-gradient(135deg, #ffffff 0%, #f5f5f5 100%);
        }
        
        #loading {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #ffffff 0%, #f5f5f5 100%);
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .spinner {
            border: 3px solid rgba(236, 28, 36, 0.1);
            border-top: 3px solid #ec1c24;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            animation: spin 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.05);
        }

        .neo-shadow {
            box-shadow: 
                8px 8px 16px rgba(96, 96, 96, 0.1),
                -8px -8px 16px rgba(255, 255, 255, 0.9);
        }

        .neo-inset {
            box-shadow: 
                inset 4px 4px 8px rgba(96, 96, 96, 0.1),
                inset -4px -4px 8px rgba(255, 255, 255, 0.9);
        }

        .range-slider {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: linear-gradient(to right, #f0f0f0, #e0e0e0);
            outline: none;
            position: absolute;
            pointer-events: none;
        }
        
        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ec1c24, #ff4d54);
            cursor: pointer;
            pointer-events: all;
            border: 2px solid white;
            box-shadow: 0 4px 12px rgba(236, 28, 36, 0.3);
            position: relative;
            z-index: 5;
            transition: all 0.2s ease;
        }
        
        .range-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ec1c24, #ff4d54);
            cursor: pointer;
            pointer-events: all;
            border: 2px solid white;
            box-shadow: 0 4px 12px rgba(236, 28, 36, 0.3);
            position: relative;
            z-index: 5;
            transition: all 0.2s ease;
        }
        
        .range-slider::-webkit-slider-thumb:hover {
            transform: scale(1.15);
            box-shadow: 0 6px 16px rgba(236, 28, 36, 0.4);
        }
        
        .range-slider::-moz-range-thumb:hover {
            transform: scale(1.15);
            box-shadow: 0 6px 16px rgba(236, 28, 36, 0.4);
        }
        
        .range-slider-track {
            height: 6px;
            border-radius: 3px;
            position: absolute;
            background: linear-gradient(90deg, #ec1c24, #ff4d54);
            pointer-events: none;
            z-index: 2;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ec1c24, #ff4d54);
            transition: all 0.3s ease;
        }

        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(135deg, #d01920, #ec1c24);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(236, 28, 36, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981, #14dc8e);
            transition: all 0.3s ease;
        }

        .btn-success:hover:not(:disabled) {
            background: linear-gradient(135deg, #0ea373, #10b981);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #f87171);
            transition: all 0.3s ease;
        }

        .btn-danger:hover:not(:disabled) {
            background: linear-gradient(135deg, #dc2626, #ef4444);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #606060, #787878);
            transition: all 0.3s ease;
        }

        .btn-secondary:hover:not(:disabled) {
            background: linear-gradient(135deg, #505050, #606060);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(96, 96, 96, 0.3);
        }

        .accent-border {
            border-left: 4px solid #ec1c24;
        }

        .glow-effect {
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(236, 28, 36, 0.2); }
            50% { box-shadow: 0 0 30px rgba(236, 28, 36, 0.4); }
        }

        input:focus, select:focus, button:focus {
            outline: none;
            border-color: #ec1c24;
            box-shadow: 0 0 0 3px rgba(236, 28, 36, 0.1);
        }

        .table-hover:hover {
            background: linear-gradient(90deg, rgba(236, 28, 36, 0.03), transparent);
            transform: translateX(2px);
            transition: all 0.2s ease;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(236, 28, 36, 0.15);
        }

        .notification-enter {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .futuristic-tab {
            position: relative;
            overflow: hidden;
        }

        .futuristic-tab::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, #ec1c24, #ff4d54);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .futuristic-tab.active::before {
            transform: scaleX(1);
        }

        .dropdown-modern {
            animation: dropdownFade 0.2s ease-out;
        }

        @keyframes dropdownFade {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#ec1c24',
                        secondary: '#606060',
                        success: '#10b981',
                        danger: '#ef4444',
                        warning: '#f59e0b',
                    }
                }
            }
        }
    </script>
</head>
<body>
    <div id="root">
        <div id="loading">
            <div class="spinner"></div>
            <p style="color: #606060; font-weight: 500; letter-spacing: 0.5px;">Cargando sistema...</p>
        </div>
    </div>
    
    <!-- React y ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- SheetJS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const Icon = ({ name, className = '', size = 24 }) => {
            const iconRef = useRef(null);
            
            useEffect(() => {
                if (iconRef.current && window.lucide) {
                    lucide.createIcons();
                }
            }, [name]);
            
            return React.createElement('i', {
                ref: iconRef,
                'data-lucide': name,
                className: className,
                style: { width: size + 'px', height: size + 'px', display: 'inline-block' }
            });
        };

        const ChartComponent = ({ type, data, options }) => {
            const canvasRef = useRef(null);
            const chartRef = useRef(null);

            useEffect(() => {
                if (canvasRef.current) {
                    const ctx = canvasRef.current.getContext('2d');
                    
                    if (chartRef.current) {
                        chartRef.current.destroy();
                    }

                    chartRef.current = new Chart(ctx, {
                        type: type,
                        data: data,
                        options: options
                    });
                }

                return () => {
                    if (chartRef.current) {
                        chartRef.current.destroy();
                    }
                };
            }, [type, data, options]);

            return <canvas ref={canvasRef}></canvas>;
        };

        const ElectricConsumptionApp = () => {
            const [data, setData] = useState([]);
            const [importHistory, setImportHistory] = useState([]);
            const [currentImportId, setCurrentImportId] = useState(1);
            const [editingRow, setEditingRow] = useState(null);
            const [editedData, setEditedData] = useState({});
            const [notification, setNotification] = useState(null);
            const [activeTab, setActiveTab] = useState('upload');
            const [stats, setStats] = useState({ total: 0, periods: 0, rpus: 0 });
            
            const [tableFilters, setTableFilters] = useState({
                importeRange: [0, 100000],
                RPU: [],
                Periodo: [],
                Dirección: [],
                Ciudad: [],
                Estado: [],
                RFC: []
            });
            const [filterSearchTerms, setFilterSearchTerms] = useState({});
            const [openFilterDropdown, setOpenFilterDropdown] = useState(null);
            
            const [filters, setFilters] = useState({
                montoRange: [0, 100000],
                estados: [],
                ciudades: [],
                rfcs: [],
                periodos: []
            });
            const [openAnalyticsDropdown, setOpenAnalyticsDropdown] = useState(null);
            const [analyticsSearchTerms, setAnalyticsSearchTerms] = useState({});

            const columns = [
                'RPU', 'Periodo', 'Nombre', 'Dirección', 'Ciudad', 'Estado', 'RFC', 
                'Colonia', 'Calle 1', 'Calle 2', 'Base imponible calculada', 'Total DAP', 
                'IVA calculado', 'Depósitos', 'Total calculado', 'Diferencia total', 
                'Diferencia IVA', 'Importe total', 'Importe energía total', 'Importe IVA', 
                'Importe DAP', 'Importe créditos a la factura', 'Diferencia más', 'Diferencia menos',
                'Fecha desde', 'Fecha hasta', 'Fecha límite de pago'
            ];

            useEffect(() => {
                updateStats();
                if (data.length > 0) {
                    const range = getMontoRange();
                    setFilters(prev => ({
                        ...prev,
                        montoRange: [range.min, range.max]
                    }));
                    setTableFilters(prev => ({
                        ...prev,
                        importeRange: [range.min, range.max]
                    }));
                }
            }, [data]);

            const updateStats = () => {
                const uniqueRPUs = new Set(data.map(row => row.RPU));
                const uniquePeriods = new Set(data.map(row => row.Periodo));
                setStats({
                    total: data.length,
                    rpus: uniqueRPUs.size,
                    periods: uniquePeriods.size
                });
            };

            const showNotification = (message, type = 'success') => {
                setNotification({ message, type });
                setTimeout(() => setNotification(null), 4000);
            };

            const getMontoRange = () => {
                if (data.length === 0) return { min: 0, max: 100000 };
                const montos = data.map(row => parseFloat(row['Importe total']) || 0).filter(m => m > 0);
                if (montos.length === 0) return { min: 0, max: 100000 };
                const min = 0;
                const max = Math.ceil(Math.max(...montos));
                return { min, max };
            };

            const processExcelFile = async (file) => {
                try {
                    const arrayBuffer = await file.arrayBuffer();
                    const workbook = XLSX.read(arrayBuffer, { 
                        cellStyles: true,
                        cellDates: true,
                        cellNF: true,
                        sheetStubs: false
                    });

                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    let jsonData = XLSX.utils.sheet_to_json(firstSheet, { 
                        header: 1,
                        defval: '',
                        raw: false
                    });

                    jsonData = jsonData.slice(18);

                    if (jsonData.length === 0) {
                        throw new Error('El archivo no contiene datos después de las primeras 18 filas');
                    }

                    jsonData = jsonData.map(row => {
                        const newRow = [...row];
                        const fechaDesde = newRow[92] || '';
                        const fechaHasta = newRow[93] || '';
                        const fechaLimitePago = newRow[94] || '';
                        let filteredRow = newRow.slice(0, 26);
                        filteredRow.splice(3, 1);
                        filteredRow.splice(2, 1);
                        filteredRow.push(fechaDesde, fechaHasta, fechaLimitePago);
                        return filteredRow;
                    });

                    const dataRows = jsonData.slice(1);

                    const processedData = dataRows.map(row => {
                        const obj = { importId: currentImportId };
                        columns.forEach((col, idx) => {
                            let value = row[idx] !== undefined ? row[idx] : '';
                            
                            if (col === 'Importe total' && value) {
                                const cleanValue = String(value).replace(/[$,\s]/g, '');
                                value = parseFloat(cleanValue) || 0;
                            }
                            
                            if (col === 'Periodo' && value) {
                                const periodoStr = String(value).replace(/\D/g, '');
                                if (periodoStr.length >= 6) {
                                    const year = periodoStr.substring(0, 4);
                                    const month = periodoStr.substring(4, 6);
                                    value = year + '-' + month;
                                }
                            }
                            
                            obj[col] = value;
                        });
                        return obj;
                    }).filter(row => row.RPU && row.Periodo);

                    return processedData;

                } catch (error) {
                    console.error('Error procesando archivo:', error);
                    throw new Error('Error al procesar el archivo: ' + error.message);
                }
            };

            const handleFileUpload = async (event) => {
                const file = event.target.files[0];
                if (!file) return;

                try {
                    const processedData = await processExcelFile(file);
                    
                    let addedCount = 0;
                    let duplicateCount = 0;
                    const newData = [...data];

                    processedData.forEach(newRow => {
                        const exists = newData.some(
                            existing => existing.RPU === newRow.RPU && existing.Periodo === newRow.Periodo
                        );

                        if (!exists) {
                            newData.push(newRow);
                            addedCount++;
                        } else {
                            duplicateCount++;
                        }
                    });

                    if (addedCount > 0) {
                        setData(newData);
                        setImportHistory([...importHistory, {
                            id: currentImportId,
                            date: new Date().toLocaleString('es-MX'),
                            fileName: file.name,
                            recordsAdded: addedCount
                        }]);
                        setCurrentImportId(currentImportId + 1);
                    }

                    showNotification(
                        'Importación completada: ' + addedCount + ' registros agregados, ' + duplicateCount + ' duplicados omitidos',
                        'success'
                    );

                } catch (error) {
                    showNotification('Error: ' + error.message, 'error');
                }

                event.target.value = '';
            };

            const deleteImport = (importId) => {
                if (window.confirm('¿Eliminar todos los registros de la importación #' + importId + '?')) {
                    const filteredData = data.filter(row => row.importId !== importId);
                    setData(filteredData);
                    setImportHistory(importHistory.filter(h => h.id !== importId));
                    showNotification('Importación #' + importId + ' eliminada correctamente', 'success');
                }
            };

            const startEdit = (index) => {
                setEditingRow(index);
                setEditedData({ ...data[index] });
            };

            const cancelEdit = () => {
                setEditingRow(null);
                setEditedData({});
            };

            const saveEdit = () => {
                const newData = [...data];
                newData[editingRow] = editedData;
                setData(newData);
                setEditingRow(null);
                setEditedData({});
                showNotification('Registro actualizado correctamente', 'success');
            };

            const handleEditChange = (field, value) => {
                setEditedData({ ...editedData, [field]: value });
            };

            const deleteRow = (index) => {
                if (window.confirm('¿Eliminar este registro?')) {
                    const newData = data.filter((_, i) => i !== index);
                    setData(newData);
                    showNotification('Registro eliminado correctamente', 'success');
                }
            };

            const exportToExcel = () => {
                const ws = XLSX.utils.json_to_sheet(data.map(row => {
                    const newObj = {};
                    Object.keys(row).forEach(key => {
                        if (key !== 'importId') {
                            newObj[key] = row[key];
                        }
                    });
                    return newObj;
                }));
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Datos');
                XLSX.writeFile(wb, 'consumo_electrico_' + new Date().toISOString().split('T')[0] + '.xlsx');
                showNotification('Archivo exportado correctamente', 'success');
            };

            const exportFilteredToExcel = () => {
                const filteredData = getFilteredTableData();
                const ws = XLSX.utils.json_to_sheet(filteredData.map(row => {
                    const newObj = {};
                    Object.keys(row).forEach(key => {
                        if (key !== 'importId') {
                            newObj[key] = row[key];
                        }
                    });
                    return newObj;
                }));
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Datos Filtrados');
                XLSX.writeFile(wb, 'consumo_electrico_filtrado_' + new Date().toISOString().split('T')[0] + '.xlsx');
                showNotification('Datos filtrados exportados correctamente', 'success');
            };

            const getFilteredTableData = () => {
                return data.filter(row => {
                    const importe = parseFloat(row['Importe total']) || 0;
                    const importeMin = tableFilters.importeRange[0];
                    const importeMax = tableFilters.importeRange[1];
                    
                    const matchImporte = importe >= importeMin && importe <= importeMax;
                    const matchRPU = tableFilters.RPU.length === 0 || tableFilters.RPU.includes(row.RPU);
                    const matchPeriodo = tableFilters.Periodo.length === 0 || tableFilters.Periodo.includes(row.Periodo);
                    const matchDireccion = tableFilters.Dirección.length === 0 || tableFilters.Dirección.includes(row.Dirección);
                    const matchCiudad = tableFilters.Ciudad.length === 0 || tableFilters.Ciudad.includes(row.Ciudad);
                    const matchEstado = tableFilters.Estado.length === 0 || tableFilters.Estado.includes(row.Estado);
                    const matchRFC = tableFilters.RFC.length === 0 || tableFilters.RFC.includes(row.RFC);
                    
                    return matchImporte && matchRPU && matchPeriodo && matchDireccion && matchCiudad && matchEstado && matchRFC;
                });
            };

            const getUniqueValues = (field) => {
                return [...new Set(data.map(row => row[field]).filter(Boolean))].sort();
            };

            const getTableFilterOptions = (field) => {
                const searchTerm = (filterSearchTerms[field] || '').toLowerCase();
                const allValues = [...new Set(data.map(row => row[field]).filter(Boolean))].sort();
                
                if (!searchTerm) return allValues;
                
                return allValues.filter(value => 
                    String(value).toLowerCase().includes(searchTerm)
                );
            };

            const getAnalyticsFilterOptions = (field) => {
                const searchTerm = (analyticsSearchTerms[field] || '').toLowerCase();
                const allValues = [...new Set(data.map(row => row[field]).filter(Boolean))].sort();
                
                if (!searchTerm) return allValues;
                
                return allValues.filter(value => 
                    String(value).toLowerCase().includes(searchTerm)
                );
            };

            const toggleFilterValue = (field, value) => {
                setTableFilters(prev => {
                    const current = prev[field] || [];
                    const newValues = current.includes(value)
                        ? current.filter(v => v !== value)
                        : [...current, value];
                    return { ...prev, [field]: newValues };
                });
            };

            const toggleAnalyticsFilterValue = (field, value) => {
                setFilters(prev => {
                    const current = prev[field] || [];
                    const newValues = current.includes(value)
                        ? current.filter(v => v !== value)
                        : [...current, value];
                    return { ...prev, [field]: newValues };
                });
            };

            const clearTableFilters = () => {
                const range = getMontoRange();
                setTableFilters({
                    importeRange: [range.min, range.max],
                    RPU: [],
                    Periodo: [],
                    Dirección: [],
                    Ciudad: [],
                    Estado: [],
                    RFC: []
                });
                setFilterSearchTerms({});
            };

            const prepareChartData = () => {
                const filteredData = data.filter(row => {
                    const importe = parseFloat(row['Importe total']) || 0;
                    const [montoMin, montoMax] = filters.montoRange;
                    
                    const matchMonto = importe >= montoMin && importe <= montoMax;
                    const matchEstado = filters.estados.length === 0 || filters.estados.includes(row.Estado);
                    const matchCiudad = filters.ciudades.length === 0 || filters.ciudades.includes(row.Ciudad);
                    const matchRFC = filters.rfcs.length === 0 || filters.rfcs.includes(row.RFC);
                    const matchPeriodo = filters.periodos.length === 0 || filters.periodos.includes(row.Periodo);
                    
                    return matchMonto && matchEstado && matchCiudad && matchRFC && matchPeriodo;
                });
                
                const byPeriod = {};
                filteredData.forEach(row => {
                    const periodo = row.Periodo || 'Sin periodo';
                    const importe = parseFloat(row['Importe total']) || 0;
                    if (!byPeriod[periodo]) {
                        byPeriod[periodo] = 0;
                    }
                    byPeriod[periodo] += importe;
                });
                
                return {
                    labels: Object.keys(byPeriod).sort(),
                    values: Object.keys(byPeriod).sort().map(k => Math.round(byPeriod[k])),
                    filteredCount: filteredData.length
                };
            };

            return (
                <div className="min-h-screen p-6" style={{background: 'linear-gradient(135deg, #ffffff 0%, #f5f5f5 100%)'}}>
                    <div className="max-w-7xl mx-auto">
                        {/* Header */}
                        <div className="glass-effect neo-shadow rounded-2xl p-6 mb-6">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-4">
                                    <div className="p-3 rounded-xl" style={{background: 'linear-gradient(135deg, #ec1c24, #ff4d54)'}}>
                                        <Icon name="zap" size={32} className="text-white" />
                                    </div>
                                    <div>
                                        <h1 className="text-3xl font-bold bg-gradient-to-r from-gray-800 to-gray-600 bg-clip-text text-transparent">
                                            Sistema de Consumo Eléctrico
                                        </h1>
                                        <p className="text-secondary mt-1" style={{letterSpacing: '0.5px'}}>Gestión inteligente de datos de facturación</p>
                                    </div>
                                </div>
                                <div className="flex gap-3">
                                    <button
                                        onClick={exportToExcel}
                                        disabled={data.length === 0}
                                        className="btn-success flex items-center gap-2 px-5 py-2.5 text-white rounded-xl font-medium disabled:opacity-40 disabled:cursor-not-allowed shadow-lg"
                                    >
                                        <Icon name="download" size={18} />
                                        Exportar Todos
                                    </button>
                                    {activeTab === 'data' && (
                                        <button
                                            onClick={exportFilteredToExcel}
                                            disabled={getFilteredTableData().length === 0}
                                            className="btn-primary flex items-center gap-2 px-5 py-2.5 text-white rounded-xl font-medium disabled:opacity-40 disabled:cursor-not-allowed shadow-lg"
                                        >
                                            <Icon name="filter" size={18} />
                                            Exportar Filtrados
                                        </button>
                                    )}
                                </div>
                            </div>
                        </div>

                        {/* Notification */}
                        {notification && (
                            <div className={'notification-enter mb-6 p-4 rounded-xl flex items-center gap-3 shadow-lg ' + (notification.type === 'success' ? 'bg-gradient-to-r from-green-50 to-emerald-50 border-l-4 border-green-500' : notification.type === 'error' ? 'bg-gradient-to-r from-red-50 to-rose-50 border-l-4 border-red-500' : 'bg-gradient-to-r from-yellow-50 to-amber-50 border-l-4 border-yellow-500')}>
                                <Icon name={notification.type === 'success' ? 'check-circle' : notification.type === 'error' ? 'alert-circle' : 'alert-triangle'} size={20} className={notification.type === 'success' ? 'text-green-600' : notification.type === 'error' ? 'text-red-600' : 'text-yellow-600'} />
                                <span className="font-medium text-gray-800">{notification.message}</span>
                            </div>
                        )}

                        {/* Stats Cards */}
                        <div className="grid grid-cols-3 gap-6 mb-6">
                            <div className="stat-card rounded-2xl p-6">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-secondary text-sm font-medium mb-1">Total Registros</p>
                                        <p className="text-4xl font-bold" style={{background: 'linear-gradient(135deg, #ec1c24, #ff4d54)', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent'}}>{stats.total}</p>
                                    </div>
                                    <div className="p-4 rounded-xl" style={{background: 'linear-gradient(135deg, rgba(236, 28, 36, 0.1), rgba(255, 77, 84, 0.1))'}}>
                                        <Icon name="database" size={28} style={{color: '#ec1c24'}} />
                                    </div>
                                </div>
                            </div>
                            <div className="stat-card rounded-2xl p-6">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-secondary text-sm font-medium mb-1">RPUs Únicos</p>
                                        <p className="text-4xl font-bold" style={{background: 'linear-gradient(135deg, #606060, #787878)', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent'}}>{stats.rpus}</p>
                                    </div>
                                    <div className="p-4 rounded-xl" style={{background: 'linear-gradient(135deg, rgba(96, 96, 96, 0.1), rgba(120, 120, 120, 0.1))'}}>
                                        <Icon name="users" size={28} style={{color: '#606060'}} />
                                    </div>
                                </div>
                            </div>
                            <div className="stat-card rounded-2xl p-6">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-secondary text-sm font-medium mb-1">Periodos</p>
                                        <p className="text-4xl font-bold" style={{background: 'linear-gradient(135deg, #ec1c24, #ff4d54)', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent'}}>{stats.periods}</p>
                                    </div>
                                    <div className="p-4 rounded-xl" style={{background: 'linear-gradient(135deg, rgba(236, 28, 36, 0.1), rgba(255, 77, 84, 0.1))'}}>
                                        <Icon name="calendar" size={28} style={{color: '#ec1c24'}} />
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Main Content */}
                        <div className="glass-effect neo-shadow rounded-2xl overflow-hidden">
                            {/* Tabs */}
                            <div className="flex border-b" style={{borderColor: 'rgba(96, 96, 96, 0.1)'}}>
                                {[
                                    { id: 'upload', icon: 'upload', label: 'Importar Datos' },
                                    { id: 'data', icon: 'table-2', label: 'Ver/Editar Datos' },
                                    { id: 'analytics', icon: 'bar-chart-3', label: 'Información' }
                                ].map(tab => (
                                    <button
                                        key={tab.id}
                                        onClick={() => setActiveTab(tab.id)}
                                        className={'futuristic-tab flex-1 px-6 py-4 font-medium transition-all ' + (activeTab === tab.id ? 'active text-primary bg-gradient-to-b from-transparent to-red-50' : 'text-secondary hover:text-gray-800 hover:bg-gray-50')}
                                    >
                                        <Icon name={tab.icon} size={20} className="inline mr-2" />
                                        {tab.label}
                                    </button>
                                ))}
                            </div>

                            {/* Tab Content */}
                            <div className="p-6">
                                {activeTab === 'upload' && (
                                    <div>
                                        <div className="border-2 border-dashed rounded-2xl p-12 text-center hover:border-primary transition-all cursor-pointer neo-inset" style={{borderColor: 'rgba(236, 28, 36, 0.2)'}}>
                                            <div className="inline-block p-6 rounded-2xl mb-4" style={{background: 'linear-gradient(135deg, rgba(236, 28, 36, 0.05), rgba(255, 77, 84, 0.05))'}}>
                                                <Icon name="upload-cloud" size={64} style={{color: '#ec1c24'}} />
                                            </div>
                                            <h3 className="text-2xl font-bold text-gray-800 mb-2">Subir Archivo Excel</h3>
                                            <p className="text-secondary mb-6">Selecciona un archivo .xlsx o .xls con datos de consumo eléctrico</p>
                                            <label className="inline-block btn-primary px-8 py-3 text-white rounded-xl cursor-pointer font-medium shadow-lg">
                                                Seleccionar Archivo
                                                <input type="file" accept=".xlsx,.xls" onChange={handleFileUpload} className="hidden" />
                                            </label>
                                        </div>

                                        {importHistory.length > 0 && (
                                            <div className="mt-8">
                                                <h3 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                                                    <Icon name="history" size={24} style={{color: '#ec1c24'}} />
                                                    Historial de Importaciones
                                                </h3>
                                                <div className="space-y-3">
                                                    {importHistory.map(imp => (
                                                        <div key={imp.id} className="flex items-center justify-between glass-effect rounded-xl p-4 hover:shadow-lg transition-all accent-border">
                                                            <div>
                                                                <p className="font-semibold text-gray-800">Importación #{imp.id} - {imp.fileName}</p>
                                                                <p className="text-sm text-secondary mt-1">{imp.date} • {imp.recordsAdded} registros agregados</p>
                                                            </div>
                                                            <button onClick={() => deleteImport(imp.id)} className="btn-danger p-3 rounded-xl shadow-md">
                                                                <Icon name="trash-2" size={20} className="text-white" />
                                                            </button>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                )}

                                {activeTab === 'data' && (
                                    <div>
                                        {data.length === 0 ? (
                                            <div className="text-center py-20">
                                                <div className="inline-block p-8 rounded-2xl mb-4" style={{background: 'linear-gradient(135deg, rgba(96, 96, 96, 0.05), rgba(120, 120, 120, 0.05))'}}>
                                                    <Icon name="inbox" size={80} className="text-gray-300" />
                                                </div>
                                                <p className="text-gray-500 text-xl font-medium">No hay datos disponibles</p>
                                                <p className="text-secondary mt-2">Importa un archivo Excel para comenzar</p>
                                            </div>
                                        ) : (
                                            <div>
                                                {/* Filtros */}
                                                <div className="glass-effect rounded-xl p-5 mb-6 neo-inset">
                                                    <div className="flex items-center justify-between mb-4">
                                                        <div className="flex items-center gap-2">
                                                            <Icon name="sliders-horizontal" size={22} style={{color: '#ec1c24'}} />
                                                            <h3 className="text-lg font-bold text-gray-800">Filtros de Tabla</h3>
                                                        </div>
                                                        <button onClick={clearTableFilters} className="btn-secondary px-4 py-2 text-white rounded-lg text-sm font-medium shadow-md">
                                                            Limpiar Filtros
                                                        </button>
                                                    </div>
                                                    
                                                    <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                                        <div className="col-span-1 md:col-span-2">
                                                            <label className="block text-sm font-semibold text-gray-700 mb-2">Importe Total</label>
                                                            <div className="flex gap-3">
                                                                <input
                                                                    type="number"
                                                                    value={tableFilters.importeRange[0]}
                                                                    onChange={(e) => {
                                                                        const newMin = parseFloat(e.target.value) || 0;
                                                                        setTableFilters(prev => ({
                                                                            ...prev,
                                                                            importeRange: [Math.max(0, newMin), prev.importeRange[1]]
                                                                        }));
                                                                    }}
                                                                    className="flex-1 px-3 py-2 text-sm border rounded-lg transition-all"
                                                                    style={{borderColor: 'rgba(96, 96, 96, 0.2)'}}
                                                                    placeholder="Mínimo"
                                                                />
                                                                <input
                                                                    type="number"
                                                                    value={tableFilters.importeRange[1]}
                                                                    onChange={(e) => {
                                                                        const newMax = parseFloat(e.target.value) || getMontoRange().max;
                                                                        setTableFilters(prev => ({
                                                                            ...prev,
                                                                            importeRange: [prev.importeRange[0], newMax]
                                                                        }));
                                                                    }}
                                                                    className="flex-1 px-3 py-2 text-sm border rounded-lg transition-all"
                                                                    style={{borderColor: 'rgba(96, 96, 96, 0.2)'}}
                                                                    placeholder="Máximo"
                                                                />
                                                            </div>
                                                        </div>

                                                        {['RPU', 'Periodo', 'Dirección', 'Ciudad', 'Estado', 'RFC'].map(field => (
                                                            <div key={field} className="relative">
                                                                <label className="block text-sm font-semibold text-gray-700 mb-2">{field}</label>
                                                                <button
                                                                    onClick={() => setOpenFilterDropdown(openFilterDropdown === field ? null : field)}
                                                                    className="w-full px-3 py-2 text-sm text-left bg-white border rounded-lg flex items-center justify-between hover:border-primary transition-all"
                                                                    style={{borderColor: 'rgba(96, 96, 96, 0.2)'}}
                                                                >
                                                                    <span className="truncate font-medium">
                                                                        {tableFilters[field].length === 0
                                                                            ? 'Todos (' + getUniqueValues(field).length + ')'
                                                                            : tableFilters[field].length + ' seleccionados'
                                                                        }
                                                                    </span>
                                                                    <Icon name="chevron-down" size={16} className="text-gray-400" />
                                                                </button>
                                                                
                                                                {openFilterDropdown === field && (
                                                                    <div className="dropdown-modern absolute z-10 w-full mt-2 bg-white border rounded-xl shadow-2xl max-h-64 overflow-hidden" style={{borderColor: 'rgba(96, 96, 96, 0.1)'}}>
                                                                        <div className="p-3 border-b" style={{borderColor: 'rgba(96, 96, 96, 0.1)'}}>
                                                                            <input
                                                                                type="text"
                                                                                value={filterSearchTerms[field] || ''}
                                                                                onChange={(e) => setFilterSearchTerms(prev => ({...prev, [field]: e.target.value}))}
                                                                                className="w-full px-3 py-2 text-sm border rounded-lg"
                                                                                style={{borderColor: 'rgba(96, 96, 96, 0.2)'}}
                                                                                placeholder="Buscar..."
                                                                            />
                                                                        </div>
                                                                        <div className="max-h-48 overflow-y-auto">
                                                                            {getTableFilterOptions(field).map(value => (
                                                                                <label key={value} className="flex items-center px-4 py-2.5 hover:bg-red-50 cursor-pointer transition-all">
                                                                                    <input
                                                                                        type="checkbox"
                                                                                        checked={tableFilters[field].includes(value)}
                                                                                        onChange={() => toggleFilterValue(field, value)}
                                                                                        className="mr-3 accent-primary"
                                                                                        style={{accentColor: '#ec1c24'}}
                                                                                    />
                                                                                    <span className="text-sm text-gray-700 font-medium truncate">{value}</span>
                                                                                </label>
                                                                            ))}
                                                                            {getTableFilterOptions(field).length === 0 && (
                                                                                <p className="px-4 py-3 text-sm text-gray-500 text-center">No hay coincidencias</p>
                                                                            )}
                                                                        </div>
                                                                    </div>
                                                                )}
                                                            </div>
                                                        ))}
                                                    </div>
                                                    
                                                    <div className="mt-4 pt-4 border-t" style={{borderColor: 'rgba(96, 96, 96, 0.1)'}}>
                                                        <p className="text-sm text-secondary">
                                                            Mostrando <span className="font-bold text-primary">{getFilteredTableData().length}</span> de {data.length} registros
                                                        </p>
                                                    </div>
                                                </div>

                                                {/* Tabla */}
                                                <div className="overflow-x-auto rounded-xl" style={{border: '1px solid rgba(96, 96, 96, 0.1)'}}>
                                                    <table className="w-full text-sm">
                                                        <thead style={{background: 'linear-gradient(135deg, #f8f8f8, #ffffff)'}}>
                                                            <tr>
                                                                <th className="px-4 py-4 text-left font-bold text-gray-700">Acciones</th>
                                                                <th className="px-4 py-4 text-left font-bold text-gray-700">Import</th>
                                                                {['RPU', 'Periodo', 'Nombre', 'Dirección', 'Ciudad', 'Estado', 'Importe total', 'Fecha desde', 'Fecha hasta', 'Fecha límite de pago'].map(col => (
                                                                    <th key={col} className="px-4 py-4 text-left font-bold text-gray-700 whitespace-nowrap">{col}</th>
                                                                ))}
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {getFilteredTableData().map((row, idx) => {
                                                                const originalIndex = data.indexOf(row);
                                                                return (
                                                                    <tr key={idx} className="table-hover" style={{borderBottom: '1px solid rgba(96, 96, 96, 0.05)'}}>
                                                                        <td className="px-4 py-3">
                                                                            {editingRow === originalIndex ? (
                                                                                <div className="flex gap-2">
                                                                                    <button onClick={saveEdit} className="btn-success p-2 rounded-lg shadow-md">
                                                                                        <Icon name="check" size={16} className="text-white" />
                                                                                    </button>
                                                                                    <button onClick={cancelEdit} className="btn-secondary p-2 rounded-lg shadow-md">
                                                                                        <Icon name="x" size={16} className="text-white" />
                                                                                    </button>
                                                                                </div>
                                                                            ) : (
                                                                                <div className="flex gap-2">
                                                                                    <button onClick={() => startEdit(originalIndex)} className="p-2 rounded-lg hover:bg-blue-50 transition-all">
                                                                                        <Icon name="edit-2" size={16} style={{color: '#606060'}} />
                                                                                    </button>
                                                                                    <button onClick={() => deleteRow(originalIndex)} className="p-2 rounded-lg hover:bg-red-50 transition-all">
                                                                                        <Icon name="trash-2" size={16} style={{color: '#ec1c24'}} />
                                                                                    </button>
                                                                                </div>
                                                                            )}
                                                                        </td>
                                                                        <td className="px-4 py-3">
                                                                            <span className="px-2 py-1 rounded-lg text-xs font-bold" style={{background: 'linear-gradient(135deg, rgba(236, 28, 36, 0.1), rgba(255, 77, 84, 0.1))', color: '#ec1c24'}}>
                                                                                #{row.importId}
                                                                            </span>
                                                                        </td>
                                                                        {['RPU', 'Periodo', 'Nombre', 'Dirección', 'Ciudad', 'Estado', 'Importe total', 'Fecha desde', 'Fecha hasta', 'Fecha límite de pago'].map(col => (
                                                                            <td key={col} className="px-4 py-3">
                                                                                {editingRow === originalIndex ? (
                                                                                    <input
                                                                                        type="text"
                                                                                        value={editedData[col] || ''}
                                                                                        onChange={(e) => handleEditChange(col, e.target.value)}
                                                                                        className="w-full px-2 py-1 border rounded-lg text-sm"
                                                                                        style={{borderColor: 'rgba(236, 28, 36, 0.3)'}}
                                                                                    />
                                                                                ) : (
                                                                                    <span className="text-gray-700 font-medium">
                                                                                        {col === 'Importe total' 
                                                                                            ? <span className="font-bold" style={{color: '#ec1c24'}}>{'$' + parseFloat(row[col] || 0).toLocaleString('es-MX', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span>
                                                                                            : row[col]
                                                                                        }
                                                                                    </span>
                                                                                )}
                                                                            </td>
                                                                        ))}
                                                                    </tr>
                                                                );
                                                            })}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                )}

                                {activeTab === 'analytics' && (
                                    <div>
                                        {data.length === 0 ? (
                                            <div className="text-center py-20">
                                                <div className="inline-block p-8 rounded-2xl mb-4" style={{background: 'linear-gradient(135deg, rgba(96, 96, 96, 0.05), rgba(120, 120, 120, 0.05))'}}>
                                                    <Icon name="trending-up" size={80} className="text-gray-300" />
                                                </div>
                                                <p className="text-gray-500 text-xl font-medium">No hay datos para analizar</p>
                                                <p className="text-secondary mt-2">Importa datos para ver gráficos y estadísticas</p>
                                            </div>
                                        ) : (
                                            <div>
                                                {/* Filtros Analytics */}
                                                <div className="glass-effect rounded-xl p-6 mb-6 neo-inset">
                                                    <div className="flex items-center gap-2 mb-5">
                                                        <Icon name="sliders-horizontal" size={22} style={{color: '#ec1c24'}} />
                                                        <h3 className="text-lg font-bold text-gray-800">Filtros de Análisis</h3>
                                                    </div>
                                                    
                                                    {/* Filtro de Rango */}
                                                    <div className="mb-6 p-5 bg-white rounded-xl border" style={{borderColor: 'rgba(96, 96, 96, 0.1)'}}>
                                                        <label className="block text-sm font-bold text-gray-700 mb-4">Rango de Importe Total</label>
                                                        <div className="space-y-3">
                                                            <div className="flex gap-4">
                                                                <div className="flex-1">
                                                                    <label className="block text-xs font-semibold text-secondary mb-2">Mínimo</label>
                                                                    <input
                                                                        type="text"
                                                                        value={'$' + filters.montoRange[0].toLocaleString('es-MX', {minimumFractionDigits: 2, maximumFractionDigits: 2})}
                                                                        onChange={(e) => {
                                                                            const cleanValue = e.target.value.replace(/[$,\s]/g, '');
                                                                            const newMin = parseFloat(cleanValue) || 0;
                                                                            setFilters({...filters, montoRange: [Math.max(0, Math.min(newMin, getMontoRange().max)), filters.montoRange[1]]});
                                                                        }}
                                                                        className="w-full px-4 py-2.5 border rounded-lg font-semibold"
                                                                        style={{borderColor: 'rgba(96, 96, 96, 0.2)'}}
                                                                        placeholder="$0.00"
                                                                    />
                                                                </div>
                                                                <div className="flex-1">
                                                                    <label className="block text-xs font-semibold text-secondary mb-2">Máximo</label>
                                                                    <input
                                                                        type="text"
                                                                        value={'$' + filters.montoRange[1].toLocaleString('es-MX', {minimumFractionDigits: 2, maximumFractionDigits: 2})}
                                                                        onChange={(e) => {
                                                                            const cleanValue = e.target.value.replace(/[$,\s]/g, '');
                                                                            const newMax = parseFloat(cleanValue) || getMontoRange().max;
                                                                            setFilters({...filters, montoRange: [filters.montoRange[0], Math.min(newMax, getMontoRange().max)]});
                                                                        }}
                                                                        className="w-full px-4 py-2.5 border rounded-lg font-semibold"
                                                                        style={{borderColor: 'rgba(96, 96, 96, 0.2)'}}
                                                                        placeholder={'$' + getMontoRange().max.toLocaleString('es-MX', {minimumFractionDigits: 2, maximumFractionDigits: 2})}
                                                                    />
                                                                </div>
                                                            </div>
                                                            <div className="relative pt-2 pb-8">
                                                                <div 
                                                                    className="range-slider-track"
                                                                    style={{
                                                                        left: (filters.montoRange[0] / getMontoRange().max) * 100 + '%',
                                                                        right: (100 - (filters.montoRange[1] / getMontoRange().max) * 100) + '%'
                                                                    }}
                                                                />
                                                                
                                                                <input
                                                                    type="range"
                                                                    min={getMontoRange().min}
                                                                    max={getMontoRange().max}
                                                                    value={filters.montoRange[0]}
                                                                    onChange={(e) => {
                                                                        const newMin = parseFloat(e.target.value);
                                                                        if (newMin <= filters.montoRange[1]) {
                                                                            setFilters({...filters, montoRange: [newMin, filters.montoRange[1]]});
                                                                        }
                                                                    }}
                                                                    className="range-slider"
                                                                    style={{ zIndex: 6 }}
                                                                />
                                                                
                                                                <input
                                                                    type="range"
                                                                    min={getMontoRange().min}
                                                                    max={getMontoRange().max}
                                                                    value={filters.montoRange[1]}
                                                                    onChange={(e) => {
                                                                        const newMax = parseFloat(e.target.value);
                                                                        if (newMax >= filters.montoRange[0]) {
                                                                            setFilters({...filters, montoRange: [filters.montoRange[0], newMax]});
                                                                        }
                                                                    }}
                                                                    className="range-slider"
                                                                    style={{ zIndex: 6 }}
                                                                />
                                                            </div>
                                                        </div>
                                                    </div>

                                                    {/* Filtros con Checkboxes */}
                                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-5">
                                                        {[
                                                            { field: 'estados', label: 'Estado', dataField: 'Estado' },
                                                            { field: 'ciudades', label: 'Ciudad', dataField: 'Ciudad' },
                                                            { field: 'rfcs', label: 'RFC', dataField: 'RFC' },
                                                            { field: 'periodos', label: 'Periodo', dataField: 'Periodo' }
                                                        ].map(({ field, label, dataField }) => (
                                                            <div key={field} className="relative">
                                                                <label className="block text-sm font-semibold text-gray-700 mb-2">{label}</label>
                                                                <button
                                                                    onClick={() => setOpenAnalyticsDropdown(openAnalyticsDropdown === field ? null : field)}
                                                                    className="w-full px-3 py-2.5 border rounded-lg text-sm text-left bg-white flex items-center justify-between hover:border-primary transition-all"
                                                                    style={{borderColor: 'rgba(96, 96, 96, 0.2)'}}
                                                                >
                                                                    <span className="truncate font-medium">
                                                                        {filters[field].length === 0
                                                                            ? 'Todos (' + getUniqueValues(dataField).length + ')'
                                                                            : filters[field].length + ' seleccionados'
                                                                        }
                                                                    </span>
                                                                    <Icon name="chevron-down" size={16} className="text-gray-400" />
                                                                </button>
                                                                
                                                                {openAnalyticsDropdown === field && (
                                                                    <div className="dropdown-modern absolute z-10 w-full mt-2 bg-white border rounded-xl shadow-2xl max-h-64 overflow-hidden" style={{borderColor: 'rgba(96, 96, 96, 0.1)'}}>
                                                                        <div className="p-3 border-b" style={{borderColor: 'rgba(96, 96, 96, 0.1)'}}>
                                                                            <input
                                                                                type="text"
                                                                                value={analyticsSearchTerms[field] || ''}
                                                                                onChange={(e) => setAnalyticsSearchTerms(prev => ({...prev, [field]: e.target.value}))}
                                                                                className="w-full px-3 py-2 text-sm border rounded-lg"
                                                                                style={{borderColor: 'rgba(96, 96, 96, 0.2)'}}
                                                                                placeholder="Buscar..."
                                                                            />
                                                                        </div>
                                                                        <div className="max-h-48 overflow-y-auto">
                                                                            {getAnalyticsFilterOptions(dataField).map(value => (
                                                                                <label key={value} className="flex items-center px-4 py-2.5 hover:bg-red-50 cursor-pointer transition-all">
                                                                                    <input
                                                                                        type="checkbox"
                                                                                        checked={filters[field].includes(value)}
                                                                                        onChange={() => toggleAnalyticsFilterValue(field, value)}
                                                                                        className="mr-3 accent-primary"
                                                                                        style={{accentColor: '#ec1c24'}}
                                                                                    />
                                                                                    <span className="text-sm text-gray-700 font-medium truncate">{value}</span>
                                                                                </label>
                                                                            ))}
                                                                            {getAnalyticsFilterOptions(dataField).length === 0 && (
                                                                                <p className="px-4 py-3 text-sm text-gray-500 text-center">No hay coincidencias</p>
                                                                            )}
                                                                        </div>
                                                                    </div>
                                                                )}
                                                            </div>
                                                        ))}
                                                    </div>

                                                    <div className="flex items-center justify-between pt-4 border-t" style={{borderColor: 'rgba(96, 96, 96, 0.1)'}}>
                                                        <p className="text-sm text-secondary">
                                                            Mostrando <span className="font-bold text-primary">{prepareChartData().filteredCount}</span> de {data.length} registros
                                                        </p>
                                                        <button
                                                            onClick={() => {
                                                                const range = getMontoRange();
                                                                setFilters({
                                                                    montoRange: [range.min, range.max],
                                                                    estados: [],
                                                                    ciudades: [],
                                                                    rfcs: [],
                                                                    periodos: []
                                                                });
                                                            }}
                                                            className="btn-secondary px-5 py-2 text-white rounded-lg text-sm font-medium shadow-md"
                                                        >
                                                            Limpiar Filtros
                                                        </button>
                                                    </div>
                                                </div>

                                                {/* Gráfico Principal */}
                                                <div className="glass-effect rounded-2xl p-6 mb-6 neo-shadow">
                                                    <div className="flex items-center gap-2 mb-5">
                                                        <div className="p-2 rounded-lg" style={{background: 'linear-gradient(135deg, rgba(236, 28, 36, 0.1), rgba(255, 77, 84, 0.1))'}}>
                                                            <Icon name="bar-chart-4" size={24} style={{color: '#ec1c24'}} />
                                                        </div>
                                                        <h3 className="text-xl font-bold text-gray-800">Suma de Importe Total por Periodo</h3>
                                                    </div>
                                                    <div style={{height: '450px'}}>
                                                        <ChartComponent
                                                            type="bar"
                                                            data={{
                                                                labels: prepareChartData().labels,
                                                                datasets: [{
                                                                    label: 'Importe Total',
                                                                    data: prepareChartData().values,
                                                                    backgroundColor: 'rgba(236, 28, 36, 0.8)',
                                                                    borderColor: '#ec1c24',
                                                                    borderWidth: 2,
                                                                    borderRadius: 8,
                                                                    barThickness: 40,
                                                                    maxBarThickness: 50,
                                                                    hoverBackgroundColor: '#ec1c24',
                                                                    hoverBorderColor: '#d01920',
                                                                    hoverBorderWidth: 3
                                                                }]
                                                            }}
                                                            options={{
                                                                responsive: true,
                                                                maintainAspectRatio: false,
                                                                plugins: {
                                                                    legend: { 
                                                                        display: true,
                                                                        position: 'top',
                                                                        labels: {
                                                                            font: {
                                                                                size: 14,
                                                                                weight: 'bold',
                                                                                family: 'Inter'
                                                                            },
                                                                            color: '#606060',
                                                                            padding: 20
                                                                        }
                                                                    },
                                                                    tooltip: {
                                                                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                                                        padding: 12,
                                                                        cornerRadius: 8,
                                                                        titleFont: {
                                                                            size: 14,
                                                                            weight: 'bold'
                                                                        },
                                                                        bodyFont: {
                                                                            size: 13
                                                                        },
                                                                        callbacks: {
                                                                            label: (context) => 'Importe Total: $' + context.parsed.y.toLocaleString('es-MX')
                                                                        }
                                                                    }
                                                                },
                                                                scales: {
                                                                    y: {
                                                                        beginAtZero: true,
                                                                        max: Math.max(...prepareChartData().values) * 1.2,
                                                                        grid: {
                                                                            color: 'rgba(96, 96, 96, 0.08)',
                                                                            drawBorder: false
                                                                        },
                                                                        ticks: {
                                                                            font: {
                                                                                size: 12,
                                                                                weight: '600',
                                                                                family: 'Inter'
                                                                            },
                                                                            color: '#606060',
                                                                            callback: (value) => '$' + (value / 1000).toFixed(0) + 'k',
                                                                            padding: 10
                                                                        }
                                                                    },
                                                                    x: {
                                                                        grid: {
                                                                            display: false,
                                                                            drawBorder: false
                                                                        },
                                                                        ticks: {
                                                                            font: {
                                                                                size: 12,
                                                                                weight: '600',
                                                                                family: 'Inter'
                                                                            },
                                                                            color: '#606060',
                                                                            maxRotation: 45,
                                                                            minRotation: 45,
                                                                            padding: 10
                                                                        }
                                                                    }
                                                                },
                                                                animation: {
                                                                    duration: 800,
                                                                    easing: 'easeInOutQuart'
                                                                }
                                                            }}
                                                        />
                                                    </div>
                                                </div>

                                                {/* Resumen Estadístico */}
                                                <div className="glass-effect rounded-2xl p-6 neo-shadow">
                                                    <div className="flex items-center gap-2 mb-5">
                                                        <div className="p-2 rounded-lg" style={{background: 'linear-gradient(135deg, rgba(236, 28, 36, 0.1), rgba(255, 77, 84, 0.1))'}}>
                                                            <Icon name="trending-up" size={24} style={{color: '#ec1c24'}} />
                                                        </div>
                                                        <h3 className="text-xl font-bold text-gray-800">Resumen Estadístico</h3>
                                                    </div>
                                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-5">
                                                        {(() => {
                                                            const filtered = data.filter(row => {
                                                                const importe = parseFloat(row['Importe total']) || 0;
                                                                const [montoMin, montoMax] = filters.montoRange;
                                                                
                                                                const matchMonto = importe >= montoMin && importe <= montoMax;
                                                                const matchEstado = filters.estados.length === 0 || filters.estados.includes(row.Estado);
                                                                const matchCiudad = filters.ciudades.length === 0 || filters.ciudades.includes(row.Ciudad);
                                                                const matchRFC = filters.rfcs.length === 0 || filters.rfcs.includes(row.RFC);
                                                                const matchPeriodo = filters.periodos.length === 0 || filters.periodos.includes(row.Periodo);
                                                                
                                                                return matchMonto && matchEstado && matchCiudad && matchRFC && matchPeriodo;
                                                            });
                                                            const totales = filtered.map(r => parseFloat(r['Importe total']) || 0);
                                                            const suma = totales.reduce((a, b) => a + b, 0);
                                                            const promedio = suma / totales.length || 0;
                                                            const max = Math.max(...totales, 0);
                                                            const min = totales.length > 0 ? Math.min(...totales.filter(t => t > 0)) : 0;
                                                            
                                                            return (
                                                                <React.Fragment>
                                                                    <div className="rounded-xl p-5 transition-all hover:shadow-lg" style={{background: 'linear-gradient(135deg, rgba(236, 28, 36, 0.05), rgba(255, 77, 84, 0.05))', border: '2px solid rgba(236, 28, 36, 0.1)'}}>
                                                                        <p className="text-secondary text-sm font-semibold mb-2">Total Facturado</p>
                                                                        <p className="text-3xl font-bold" style={{color: '#ec1c24'}}>{'$' + suma.toLocaleString('es-MX', {maximumFractionDigits: 0})}</p>
                                                                    </div>
                                                                    <div className="rounded-xl p-5 transition-all hover:shadow-lg" style={{background: 'linear-gradient(135deg, rgba(16, 185, 129, 0.05), rgba(20, 220, 142, 0.05))', border: '2px solid rgba(16, 185, 129, 0.1)'}}>
                                                                        <p className="text-secondary text-sm font-semibold mb-2">Promedio</p>
                                                                        <p className="text-3xl font-bold" style={{color: '#10b981'}}>{'$' + promedio.toLocaleString('es-MX', {maximumFractionDigits: 0})}</p>
                                                                    </div>
                                                                    <div className="rounded-xl p-5 transition-all hover:shadow-lg" style={{background: 'linear-gradient(135deg, rgba(96, 96, 96, 0.05), rgba(120, 120, 120, 0.05))', border: '2px solid rgba(96, 96, 96, 0.1)'}}>
                                                                        <p className="text-secondary text-sm font-semibold mb-2">Máximo</p>
                                                                        <p className="text-3xl font-bold" style={{color: '#606060'}}>{'$' + max.toLocaleString('es-MX', {maximumFractionDigits: 0})}</p>
                                                                    </div>
                                                                    <div className="rounded-xl p-5 transition-all hover:shadow-lg" style={{background: 'linear-gradient(135deg, rgba(245, 158, 11, 0.05), rgba(251, 191, 36, 0.05))', border: '2px solid rgba(245, 158, 11, 0.1)'}}>
                                                                        <p className="text-secondary text-sm font-semibold mb-2">Mínimo</p>
                                                                        <p className="text-3xl font-bold" style={{color: '#f59e0b'}}>{'$' + min.toLocaleString('es-MX', {maximumFractionDigits: 0})}</p>
                                                                    </div>
                                                                </React.Fragment>
                                                            );
                                                        })()}
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ElectricConsumptionApp />);
    </script>
</body>
</html>